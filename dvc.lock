schema: '2.0'
stages:
  data_ingestion:
    cmd: python -m src.pipeline.stage_01_ingestion
    deps:
    - path: config/config.yaml
      hash: md5
      md5: 25502013733b37b1791752c17a189ffd
      size: 1566
    - path: src/pipeline/stage_01_ingestion.py
      hash: md5
      md5: 9e23756ed8586beebebe61947bc60562
      size: 2065
    outs:
    - path: artifacts/data_ingestion/books.csv
      hash: md5
      md5: fb986e694176649505eec4a383b8a3eb
      size: 4142211
  data_transformation:
    cmd: python -m src.pipeline.stage_03_transformation
    deps:
    - path: artifacts/data_validation/clean_books.csv
      hash: md5
      md5: 347fb6fccc65741c133914afb6cdcf1c
      size: 4134467
    - path: src/pipeline/stage_03_transformation.py
      hash: md5
      md5: 80877250073d8aa03d31e8638974ba3c
      size: 2027
    params:
      config/params.yaml:
        data_transformation.random_state: 42
        data_transformation.test_size: 0.3
        data_transformation.val_size: 0.5
    outs:
    - path: artifacts/data_transformation
      hash: md5
      md5: 98e44a13a1f2caff40aa29164e5914e3.dir
      size: 4134411
      nfiles: 3
  data_validation:
    cmd: python -m src.pipeline.stage_02_validation
    deps:
    - path: artifacts/data_ingestion/books.csv
      hash: md5
      md5: fb986e694176649505eec4a383b8a3eb
      size: 4142211
    - path: src/pipeline/stage_02_validation.py
      hash: md5
      md5: af8419a87ba89b8806d6afb7fb7b6540
      size: 1858
    params:
      config/params.yaml:
        data_validation.categories_min_len: 2
        data_validation.min_desc_len: 20
    outs:
    - path: artifacts/data_validation/clean_books.csv
      hash: md5
      md5: 347fb6fccc65741c133914afb6cdcf1c
      size: 4134467
  model_training:
    cmd: python -m src.pipeline.stage_04_training
    deps:
    - path: artifacts/data_transformation
      hash: md5
      md5: 98e44a13a1f2caff40aa29164e5914e3.dir
      size: 4134411
      nfiles: 3
    - path: config/config.yaml
      hash: md5
      md5: 25502013733b37b1791752c17a189ffd
      size: 1566
    - path: src/pipeline/stage_04_training.py
      hash: md5
      md5: 742d1668fb9231118d591cf515c1a3b6
      size: 1941
    params:
      config/params.yaml:
        model_trainer.collection_name: books
        model_trainer.model_name: sentence-transformers/all-MiniLM-L6-v2
    outs:
    - path: artifacts/model_trainer/vectordb
      hash: md5
      md5: dfc138e34c5875787eb4d75451d7dd12.dir
      size: 33393004
      nfiles: 6
  prediction:
    cmd: python -m src.pipeline.stage_05_prediction
    deps:
    - path: artifacts/data_validation/clean_books.csv
      hash: md5
      md5: 347fb6fccc65741c133914afb6cdcf1c
      size: 4134467
    - path: artifacts/model_trainer/vectordb
      hash: md5
      md5: 370198ce1c6c9fe18347b1bf045080e2.dir
      size: 33393004
      nfiles: 6
    - path: src/models/hybrid_recommender.py
      hash: md5
      md5: cbe862109ad7b70df600bda669423158
      size: 8479
    - path: src/pipeline/stage_05_prediction.py
      hash: md5
      md5: 8d34f98c9805ca8f038363831692fe97
      size: 2422
    params:
      config/params.yaml:
        inference.popularity_weight: 0.2
        inference.top_k: 50
    outs:
    - path: artifacts/prediction/results.txt
      hash: md5
      md5: c8c1bb0b16d654fe802b273d2a6389fa
      size: 31451
  model_evaluation:
    cmd: python -m src.pipeline.stage_06_evaluation
    deps:
    - path: artifacts/data_transformation/test.csv
      hash: md5
      md5: e147ae3bdf81d80b3b81b17da9985ec6
      size: 612293
    - path: artifacts/model_trainer/vectordb
      hash: md5
      md5: 370198ce1c6c9fe18347b1bf045080e2.dir
      size: 33393004
      nfiles: 6
    - path: config/config.yaml
      hash: md5
      md5: 25502013733b37b1791752c17a189ffd
      size: 1566
    - path: src/pipeline/stage_06_evaluation.py
      hash: md5
      md5: fa2515f485832b8534c031c60f4d3298
      size: 1714
    params:
      config/params.yaml:
        mlflow.experiment_name: Hybrid-Book-Recommender-System
        mlflow.uri: 
          https://dagshub.com/SebastianGarrido2790/hybrid-book-recommender.mlflow
    outs:
    - path: artifacts/model_evaluation/metrics.json
      hash: md5
      md5: e200a0f5225d0fa1cfff4f3c8c091a87
      size: 33
