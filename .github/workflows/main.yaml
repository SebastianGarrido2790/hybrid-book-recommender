name: Hybrid Recommender CI/CD

on:
  push:
    branches: ["main"]
  pull_request: # This is crucial for catching bugs before merging code.
    branches: ["main"]

jobs:
  test_and_build:
    # This ensures our code runs on a clean standard OS, not just on your local Windows machine.
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4 # This downloads your code to the runner.

      - name: Install uv
        uses: astral-sh/setup-uv@v5 # This installs the 'uv' package manager.
        with:
          enable-cache: true # This saves downloaded packages between runs.

      - name: Set up Python
        run: uv python install 3.11 # This ensures we use the same Python version as local.

      - name: Install Dependencies
        run: uv sync --frozen # This installs the exact dependencies from uv.lock.

      - name: Run Unit Tests
        run: uv run pytest src/tests -v # This runs the tests we wrote in Phase 4.

      - name: Verify Docker Build # This checks if the container can be built.
        run: |
          if docker info > /dev/null 2>&1; then
             docker build . -t hybrid-recommender:latest # This checks if the container can be built.
          else
             echo "Docker engine is not running. Skipping build verification."
          fi
